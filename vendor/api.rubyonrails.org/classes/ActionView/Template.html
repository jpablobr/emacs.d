<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <title>Class: ActionView::Template</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../rdoc-style.css" type="text/css" media="screen" />

    <script language="JavaScript" type="text/javascript">
    // <![CDATA[

        function toggleSource( id )
        {
          var elem
          var link

          if( document.getElementById )
          {
            elem = document.getElementById( id )
            link = document.getElementById( "l_" + id )
          }
          else if ( document.all )
          {
            elem = eval( "document.all." + id )
            link = eval( "document.all.l_" + id )
          }
          else
            return false;

          if( elem.style.display == "block" )
          {
            elem.style.display = "none"
            link.innerHTML = "show source"
          }
          else
          {
            elem.style.display = "block"
            link.innerHTML = "hide source"
          }
        }

        function openCode( url )
        {
          window.open( url, "SOURCE_CODE", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=480,width=750" ).focus();
        }
      // ]]>
    </script>
  </head>

  <body>
    <table width="100%" border='0' cellpadding='0' cellspacing='0' class='banner'>
    <tr><td>Ruby on Rails v3.0.3</td></tr>
    <tr>
  <td class="file-title"><span class="file-title-prefix">Class</span><br />ActionView::Template</td>
  <td align="right">
    <table cellspacing="0" cellpadding="2">
      <tr valign="top">
        <td>In:</td>
        <td>
<a href="../../files/actionpack/lib/action_view/template_rb.html">actionpack/lib/action_view/template.rb</a>:
<a href="../../files/actionpack/lib/action_view/template/handlers/erb_rb.html">actionpack/lib/action_view/template/handlers/erb.rb</a>:
<a href="../../files/actionpack/lib/action_view/template/handlers_rb.html">actionpack/lib/action_view/template/handlers.rb</a>:
<a href="../../files/actionpack/lib/action_view/template/error_rb.html">actionpack/lib/action_view/template/error.rb</a>:
<a href="../../files/actionpack/lib/action_view/template/text_rb.html">actionpack/lib/action_view/template/text.rb</a>:
<a href="../../files/actionpack/lib/action_view/template/handler_rb.html">actionpack/lib/action_view/template/handler.rb</a>:
        </td>
      </tr>
      <tr>
        <td>Parent:</td>
        <td>

      <a href="../Object.html">Object</a>         </td>
     </tr>
         </table>
        </td>
        </tr>
      </table>
  <div id="bodyContent">
  <div id="content">

  <div class="description"><h1>Action View <a href="Template.html">Template</a></h1>
<hr style="height: 1px"></hr><h1>Action View <a href="Template.html">Template</a> Handlers</h1>
<hr style="height: 1px"></hr><h1>Action View Text <a href="Template.html">Template</a></h1>
</div>


  <div class="sectiontitle">Methods</div>
  <ul>
                <li><a href="#method-i-build_method_name">build_method_name</a></li>
                <li><a href="#method-i-compile">compile</a></li>
                <li><a href="#method-i-counter_name">counter_name</a></li>
                <li><a href="#method-i-identifier_method_name">identifier_method_name</a></li>
                <li><a href="#method-i-inspect">inspect</a></li>
                <li><a href="#method-i-mime_type">mime_type</a></li>
                <li><a href="#method-c-new">new</a></li>
                <li><a href="#method-i-render">render</a></li>
                <li><a href="#method-i-variable_name">variable_name</a></li>
      </ul>


  <div class="sectiontitle">Constants</div>
  <table border='0' cellpadding='5'>
  <tr valign='top'>
    <td class="attr-name">Finalizer</td>
    <td>=</td>
    <td class="attr-value">proc do |method_name, mod|       proc do         mod.module_eval do           remove_possible_method method_name         end       end     end</td>
  </tr>
  </table>

  <div class="sectiontitle">Attributes</div>
  <table border='0' cellpadding='5'>
  <tr valign='top'>
    <td class='attr-rw'>
[R]
    </td>
    <td class='attr-name'>source</td>
    <td class='attr-desc'>
                        </td>
  </tr>
  <tr valign='top'>
    <td class='attr-rw'>
[R]
    </td>
    <td class='attr-name'>identifier</td>
    <td class='attr-desc'>
                        </td>
  </tr>
  <tr valign='top'>
    <td class='attr-rw'>
[R]
    </td>
    <td class='attr-name'>handler</td>
    <td class='attr-desc'>
                        </td>
  </tr>
  <tr valign='top'>
    <td class='attr-rw'>
[R]
    </td>
    <td class='attr-name'>virtual_path</td>
    <td class='attr-desc'>
                        </td>
  </tr>
  <tr valign='top'>
    <td class='attr-rw'>
[R]
    </td>
    <td class='attr-name'>formats</td>
    <td class='attr-desc'>
                        </td>
  </tr>
  <tr valign='top'>
    <td class='attr-rw'>
[R]
    </td>
    <td class='attr-name'>original_encoding</td>
    <td class='attr-desc'>
                        </td>
  </tr>
  </table>

        
    <div class="sectiontitle">
      Public      Class      methods
    </div>

          
      <div class="method">
        <div class="title">
                      <a name="method-c-new"></a>
            <b>new</b>(source, identifier, handler, details)          
        </div>

                  <div class="description">
                      </div>
        
        
                  <div class="sourcecode">
            <p class="source-link">[
            <a href="javascript:toggleSource('new_source')"
                 id="l_method-c-new_source">
              show source
            </a> ]</p>
            <div class="dyn-source"
                    id="new_source">
<pre>
       <span class="ruby-comment cmt"># File actionpack/lib/action_view/template.rb, line 112</span>
112:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">source</span>, <span class="ruby-identifier">identifier</span>, <span class="ruby-identifier">handler</span>, <span class="ruby-identifier">details</span>)
113:       <span class="ruby-ivar">@source</span>             = <span class="ruby-identifier">source</span>
114:       <span class="ruby-ivar">@identifier</span>         = <span class="ruby-identifier">identifier</span>
115:       <span class="ruby-ivar">@handler</span>            = <span class="ruby-identifier">handler</span>
116:       <span class="ruby-ivar">@original_encoding</span>  = <span class="ruby-keyword kw">nil</span>
117:       <span class="ruby-ivar">@method_names</span>       = {}
118: 
119:       <span class="ruby-identifier">format</span>   = <span class="ruby-identifier">details</span>[<span class="ruby-value">:format</span>] <span class="ruby-operator">||</span> <span class="ruby-value">:html</span>
120:       <span class="ruby-ivar">@formats</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">wrap</span>(<span class="ruby-identifier">format</span>).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:to_sym</span>)
121:       <span class="ruby-ivar">@virtual_path</span> = <span class="ruby-identifier">details</span>[<span class="ruby-value">:virtual_path</span>].<span class="ruby-identifier">try</span>(<span class="ruby-value">:sub</span>, <span class="ruby-node">&quot;.#{format}&quot;</span>, <span class="ruby-value str">&quot;&quot;</span>)
122:     <span class="ruby-keyword kw">end</span></pre>
            </div>
          </div>
        
      </div>

                      
    <div class="sectiontitle">
      Public      Instance      methods
    </div>

          
      <div class="method">
        <div class="title">
                      <a name="method-i-counter_name"></a>
            <b>counter_name</b>()          
        </div>

                  <div class="description">
                      </div>
        
        
                  <div class="sourcecode">
            <p class="source-link">[
            <a href="javascript:toggleSource('counter-name_source')"
                 id="l_method-i-counter_name_source">
              show source
            </a> ]</p>
            <div class="dyn-source"
                    id="counter-name_source">
<pre>
       <span class="ruby-comment cmt"># File actionpack/lib/action_view/template.rb, line 154</span>
154:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">counter_name</span>
155:       <span class="ruby-ivar">@counter_name</span> <span class="ruby-operator">||=</span> <span class="ruby-node">&quot;#{variable_name}_counter&quot;</span>.<span class="ruby-identifier">to_sym</span>
156:     <span class="ruby-keyword kw">end</span></pre>
            </div>
          </div>
        
      </div>

          
      <div class="method">
        <div class="title">
                      <a name="method-i-inspect"></a>
            <b>inspect</b>()          
        </div>

                  <div class="description">
                      </div>
        
        
                  <div class="sourcecode">
            <p class="source-link">[
            <a href="javascript:toggleSource('inspect_source')"
                 id="l_method-i-inspect_source">
              show source
            </a> ]</p>
            <div class="dyn-source"
                    id="inspect_source">
<pre>
       <span class="ruby-comment cmt"># File actionpack/lib/action_view/template.rb, line 158</span>
158:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">inspect</span>
159:       <span class="ruby-ivar">@inspect</span> <span class="ruby-operator">||=</span>
160:         <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">defined?</span>(<span class="ruby-constant">Rails</span>.<span class="ruby-identifier">root</span>)
161:           <span class="ruby-identifier">identifier</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-node">&quot;#{Rails.root}/&quot;</span>, <span class="ruby-value str">''</span>)
162:         <span class="ruby-keyword kw">else</span>
163:           <span class="ruby-identifier">identifier</span>
164:         <span class="ruby-keyword kw">end</span>
165:     <span class="ruby-keyword kw">end</span></pre>
            </div>
          </div>
        
      </div>

          
      <div class="method">
        <div class="title">
                      <a name="method-i-mime_type"></a>
            <b>mime_type</b>()          
        </div>

                  <div class="description">
                      </div>
        
        
                  <div class="sourcecode">
            <p class="source-link">[
            <a href="javascript:toggleSource('mime-type_source')"
                 id="l_method-i-mime_type_source">
              show source
            </a> ]</p>
            <div class="dyn-source"
                    id="mime-type_source">
<pre>
       <span class="ruby-comment cmt"># File actionpack/lib/action_view/template.rb, line 146</span>
146:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">mime_type</span>
147:       <span class="ruby-ivar">@mime_type</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Mime</span><span class="ruby-operator">::</span><span class="ruby-constant">Type</span>.<span class="ruby-identifier">lookup_by_extension</span>(<span class="ruby-ivar">@formats</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">to_s</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@formats</span>.<span class="ruby-identifier">first</span>
148:     <span class="ruby-keyword kw">end</span></pre>
            </div>
          </div>
        
      </div>

          
      <div class="method">
        <div class="title">
                      <a name="method-i-render"></a>
            <b>render</b>(view, locals, &block)          
        </div>

                  <div class="description">
                      </div>
        
        
                  <div class="sourcecode">
            <p class="source-link">[
            <a href="javascript:toggleSource('render_source')"
                 id="l_method-i-render_source">
              show source
            </a> ]</p>
            <div class="dyn-source"
                    id="render_source">
<pre>
       <span class="ruby-comment cmt"># File actionpack/lib/action_view/template.rb, line 124</span>
124:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">render</span>(<span class="ruby-identifier">view</span>, <span class="ruby-identifier">locals</span>, &amp;<span class="ruby-identifier">block</span>)
125:       <span class="ruby-comment cmt"># Notice that we use a bang in this instrumentation because you don't want to</span>
126:       <span class="ruby-comment cmt"># consume this in production. This is only slow if it's being listened to.</span>
127:       <span class="ruby-constant">ActiveSupport</span><span class="ruby-operator">::</span><span class="ruby-constant">Notifications</span>.<span class="ruby-identifier">instrument</span>(<span class="ruby-value str">&quot;!render_template.action_view&quot;</span>, <span class="ruby-value">:virtual_path</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@virtual_path</span>) <span class="ruby-keyword kw">do</span>
128:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">view</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">ActionView</span><span class="ruby-operator">::</span><span class="ruby-constant">CompiledTemplates</span>)
129:           <span class="ruby-identifier">mod</span> = <span class="ruby-constant">ActionView</span><span class="ruby-operator">::</span><span class="ruby-constant">CompiledTemplates</span>
130:         <span class="ruby-keyword kw">else</span>
131:           <span class="ruby-identifier">mod</span> = <span class="ruby-identifier">view</span>.<span class="ruby-identifier">singleton_class</span>
132:         <span class="ruby-keyword kw">end</span>
133: 
134:         <span class="ruby-identifier">method_name</span> = <span class="ruby-identifier">compile</span>(<span class="ruby-identifier">locals</span>, <span class="ruby-identifier">view</span>, <span class="ruby-identifier">mod</span>)
135:         <span class="ruby-identifier">view</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">method_name</span>, <span class="ruby-identifier">locals</span>, &amp;<span class="ruby-identifier">block</span>)
136:       <span class="ruby-keyword kw">end</span>
137:     <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
138:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">e</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Template</span><span class="ruby-operator">::</span><span class="ruby-constant">Error</span>)
139:         <span class="ruby-identifier">e</span>.<span class="ruby-identifier">sub_template_of</span>(<span class="ruby-keyword kw">self</span>)
140:         <span class="ruby-identifier">raise</span> <span class="ruby-identifier">e</span>
141:       <span class="ruby-keyword kw">else</span>
142:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">Template</span><span class="ruby-operator">::</span><span class="ruby-constant">Error</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">view</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:assigns</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">view</span>.<span class="ruby-identifier">assigns</span> <span class="ruby-operator">:</span> {}, <span class="ruby-identifier">e</span>)
143:       <span class="ruby-keyword kw">end</span>
144:     <span class="ruby-keyword kw">end</span></pre>
            </div>
          </div>
        
      </div>

          
      <div class="method">
        <div class="title">
                      <a name="method-i-variable_name"></a>
            <b>variable_name</b>()          
        </div>

                  <div class="description">
                      </div>
        
        
                  <div class="sourcecode">
            <p class="source-link">[
            <a href="javascript:toggleSource('variable-name_source')"
                 id="l_method-i-variable_name_source">
              show source
            </a> ]</p>
            <div class="dyn-source"
                    id="variable-name_source">
<pre>
       <span class="ruby-comment cmt"># File actionpack/lib/action_view/template.rb, line 150</span>
150:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">variable_name</span>
151:       <span class="ruby-ivar">@variable_name</span> <span class="ruby-operator">||=</span> <span class="ruby-ivar">@virtual_path</span>[<span class="ruby-regexp re">%_?(\w+)(\.\w+)*$'</span>, <span class="ruby-value">1</span>].<span class="ruby-identifier">to_sym</span>
152:     <span class="ruby-keyword kw">end</span></pre>
            </div>
          </div>
        
      </div>

              
    <div class="sectiontitle">
      Private      Instance      methods
    </div>

          
      <div class="method">
        <div class="title">
                      <a name="method-i-build_method_name"></a>
            <b>build_method_name</b>(locals)          
        </div>

                  <div class="description">
                      </div>
        
        
                  <div class="sourcecode">
            <p class="source-link">[
            <a href="javascript:toggleSource('build-method-name_source')"
                 id="l_method-i-build_method_name_source">
              show source
            </a> ]</p>
            <div class="dyn-source"
                    id="build-method-name_source">
<pre>
       <span class="ruby-comment cmt"># File actionpack/lib/action_view/template.rb, line 270</span>
270:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">build_method_name</span>(<span class="ruby-identifier">locals</span>)
271:         <span class="ruby-ivar">@method_names</span>[<span class="ruby-identifier">locals</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">hash</span>] <span class="ruby-operator">||=</span> <span class="ruby-node">&quot;_#{identifier_method_name}__#{@identifier.hash}_#{__id__}_#{locals.keys.hash}&quot;</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-value str">'-'</span>, <span class="ruby-value str">&quot;_&quot;</span>)
272:       <span class="ruby-keyword kw">end</span></pre>
            </div>
          </div>
        
      </div>

          
      <div class="method">
        <div class="title">
                      <a name="method-i-compile"></a>
            <b>compile</b>(locals, view, mod)          
        </div>

                  <div class="description">
            <p>
Among other things, this method is responsible for properly setting the
encoding of the source. Until this point, we assume that the source is
BINARY data. If no additional information is supplied, we assume the
encoding is the same as Encoding.default_external.
</p>
<p>
The user can also specify the encoding via a comment on the first line of
the template (# encoding: NAME-OF-ENCODING). This will work with any
template engine, as we process out the encoding comment before passing the
source on to the template engine, leaving a blank line in its stead.
</p>
<p>
If the template engine handles encodings, we send the encoded String to the
engine without further processing. This allows the template engine to
support additional mechanisms for specifying the encoding. For instance, <a
href="../ERB.html">ERB</a> supports <%# encoding: %>
</p>
<p>
Otherwise, after we figure out the correct encoding, we then encode the
source into Encoding.default_internal. In general, this means that
templates will be UTF-8 inside of <a href="../Rails.html">Rails</a>,
regardless of the original source encoding.
</p>          </div>
        
        
                  <div class="sourcecode">
            <p class="source-link">[
            <a href="javascript:toggleSource('compile_source')"
                 id="l_method-i-compile_source">
              show source
            </a> ]</p>
            <div class="dyn-source"
                    id="compile_source">
<pre>
       <span class="ruby-comment cmt"># File actionpack/lib/action_view/template.rb, line 188</span>
188:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">compile</span>(<span class="ruby-identifier">locals</span>, <span class="ruby-identifier">view</span>, <span class="ruby-identifier">mod</span>)
189:         <span class="ruby-identifier">method_name</span> = <span class="ruby-identifier">build_method_name</span>(<span class="ruby-identifier">locals</span>)
190:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">method_name</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">view</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">method_name</span>)
191: 
192:         <span class="ruby-identifier">locals_code</span> = <span class="ruby-identifier">locals</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">map!</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">key</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;#{key} = local_assigns[:#{key}];&quot;</span> }.<span class="ruby-identifier">join</span>
193: 
194:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">source</span>.<span class="ruby-identifier">encoding_aware?</span>
195:           <span class="ruby-comment cmt"># Look for # encoding: *. If we find one, we'll encode the</span>
196:           <span class="ruby-comment cmt"># String in that encoding, otherwise, we'll use the</span>
197:           <span class="ruby-comment cmt"># default external encoding.</span>
198:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">source</span>.<span class="ruby-identifier">sub!</span>(<span class="ruby-node">/\A#{ENCODING_FLAG}/</span>, <span class="ruby-value str">''</span>)
199:             <span class="ruby-identifier">encoding</span> = <span class="ruby-identifier">magic_encoding</span> = <span class="ruby-node">$1</span>
200:           <span class="ruby-keyword kw">else</span>
201:             <span class="ruby-identifier">encoding</span> = <span class="ruby-constant">Encoding</span>.<span class="ruby-identifier">default_external</span>
202:           <span class="ruby-keyword kw">end</span>
203: 
204:           <span class="ruby-comment cmt"># Tag the source with the default external encoding</span>
205:           <span class="ruby-comment cmt"># or the encoding specified in the file</span>
206:           <span class="ruby-identifier">source</span>.<span class="ruby-identifier">force_encoding</span>(<span class="ruby-identifier">encoding</span>)
207: 
208:           <span class="ruby-comment cmt"># If the user didn't specify an encoding, and the handler</span>
209:           <span class="ruby-comment cmt"># handles encodings, we simply pass the String as is to</span>
210:           <span class="ruby-comment cmt"># the handler (with the default_external tag)</span>
211:           <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">magic_encoding</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@handler</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:handles_encoding?</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@handler</span>.<span class="ruby-identifier">handles_encoding?</span>
212:             <span class="ruby-identifier">source</span>
213:           <span class="ruby-comment cmt"># Otherwise, if the String is valid in the encoding,</span>
214:           <span class="ruby-comment cmt"># encode immediately to default_internal. This means</span>
215:           <span class="ruby-comment cmt"># that if a handler doesn't handle encodings, it will</span>
216:           <span class="ruby-comment cmt"># always get Strings in the default_internal</span>
217:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">source</span>.<span class="ruby-identifier">valid_encoding?</span>
218:             <span class="ruby-identifier">source</span>.<span class="ruby-identifier">encode!</span>
219:           <span class="ruby-comment cmt"># Otherwise, since the String is invalid in the encoding</span>
220:           <span class="ruby-comment cmt"># specified, raise an exception</span>
221:           <span class="ruby-keyword kw">else</span>
222:             <span class="ruby-identifier">raise</span> <span class="ruby-constant">WrongEncodingError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">source</span>, <span class="ruby-identifier">encoding</span>)
223:           <span class="ruby-keyword kw">end</span>
224:         <span class="ruby-keyword kw">end</span>
225: 
226:         <span class="ruby-identifier">code</span> = <span class="ruby-ivar">@handler</span>.<span class="ruby-identifier">call</span>(<span class="ruby-keyword kw">self</span>)
227: 
228:         <span class="ruby-comment cmt"># Make sure that the resulting String to be evalled is in the</span>
229:         <span class="ruby-comment cmt"># encoding of the code</span>
230:         <span class="ruby-identifier">source</span> = <span class="ruby-value str">          def #{method_name}(local_assigns)            _old_virtual_path, @_virtual_path = @_virtual_path, #{@virtual_path.inspect};_old_output_buffer = @output_buffer;#{locals_code};#{code}          ensure            @_virtual_path, @output_buffer = _old_virtual_path, _old_output_buffer          end</span>
231: 
232:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">source</span>.<span class="ruby-identifier">encoding_aware?</span>
233:           <span class="ruby-comment cmt"># Make sure the source is in the encoding of the returned code</span>
234:           <span class="ruby-identifier">source</span>.<span class="ruby-identifier">force_encoding</span>(<span class="ruby-identifier">code</span>.<span class="ruby-identifier">encoding</span>)
235: 
236:           <span class="ruby-comment cmt"># In case we get back a String from a handler that is not in</span>
237:           <span class="ruby-comment cmt"># BINARY or the default_internal, encode it to the default_internal</span>
238:           <span class="ruby-identifier">source</span>.<span class="ruby-identifier">encode!</span>
239: 
240:           <span class="ruby-comment cmt"># Now, validate that the source we got back from the template</span>
241:           <span class="ruby-comment cmt"># handler is valid in the default_internal. This is for handlers</span>
242:           <span class="ruby-comment cmt"># that handle encoding but screw up</span>
243:           <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">source</span>.<span class="ruby-identifier">valid_encoding?</span>
244:             <span class="ruby-identifier">raise</span> <span class="ruby-constant">WrongEncodingError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@source</span>, <span class="ruby-constant">Encoding</span>.<span class="ruby-identifier">default_internal</span>)
245:           <span class="ruby-keyword kw">end</span>
246:         <span class="ruby-keyword kw">end</span>
247: 
248:         <span class="ruby-keyword kw">begin</span>
249:           <span class="ruby-identifier">mod</span>.<span class="ruby-identifier">module_eval</span>(<span class="ruby-identifier">source</span>, <span class="ruby-identifier">identifier</span>, <span class="ruby-value">0</span>)
250:           <span class="ruby-constant">ObjectSpace</span>.<span class="ruby-identifier">define_finalizer</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-constant">Finalizer</span>[<span class="ruby-identifier">method_name</span>, <span class="ruby-identifier">mod</span>])
251: 
252:           <span class="ruby-identifier">method_name</span>
253:         <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span> <span class="ruby-comment cmt"># errors from template code</span>
254:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">logger</span> = (<span class="ruby-identifier">view</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">view</span>.<span class="ruby-identifier">logger</span>)
255:             <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span> <span class="ruby-node">&quot;ERROR: compiling #{method_name} RAISED #{e}&quot;</span>
256:             <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span> <span class="ruby-node">&quot;Function body: #{source}&quot;</span>
257:             <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span> <span class="ruby-node">&quot;Backtrace: #{e.backtrace.join(&quot;\n&quot;)}&quot;</span>
258:           <span class="ruby-keyword kw">end</span>
259: 
260:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">ActionView</span><span class="ruby-operator">::</span><span class="ruby-constant">Template</span><span class="ruby-operator">::</span><span class="ruby-constant">Error</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">self</span>, {}, <span class="ruby-identifier">e</span>)
261:         <span class="ruby-keyword kw">end</span>
262:       <span class="ruby-keyword kw">end</span></pre>
            </div>
          </div>
        
      </div>

          
      <div class="method">
        <div class="title">
                      <a name="method-i-identifier_method_name"></a>
            <b>identifier_method_name</b>()          
        </div>

                  <div class="description">
                      </div>
        
        
                  <div class="sourcecode">
            <p class="source-link">[
            <a href="javascript:toggleSource('identifier-method-name_source')"
                 id="l_method-i-identifier_method_name_source">
              show source
            </a> ]</p>
            <div class="dyn-source"
                    id="identifier-method-name_source">
<pre>
       <span class="ruby-comment cmt"># File actionpack/lib/action_view/template.rb, line 274</span>
274:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">identifier_method_name</span>
275:         <span class="ruby-ivar">@identifier_method_name</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">inspect</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/[^a-z_]/</span>, <span class="ruby-value str">'_'</span>)
276:       <span class="ruby-keyword kw">end</span></pre>
            </div>
          </div>
        
      </div>

      </div>
  </div>
  </body>
</html>
