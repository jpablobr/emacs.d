<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <title>Module: ActionController::RequestForgeryProtection</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../rdoc-style.css" type="text/css" media="screen" />

    <script language="JavaScript" type="text/javascript">
    // <![CDATA[

        function toggleSource( id )
        {
          var elem
          var link

          if( document.getElementById )
          {
            elem = document.getElementById( id )
            link = document.getElementById( "l_" + id )
          }
          else if ( document.all )
          {
            elem = eval( "document.all." + id )
            link = eval( "document.all.l_" + id )
          }
          else
            return false;

          if( elem.style.display == "block" )
          {
            elem.style.display = "none"
            link.innerHTML = "show source"
          }
          else
          {
            elem.style.display = "block"
            link.innerHTML = "hide source"
          }
        }

        function openCode( url )
        {
          window.open( url, "SOURCE_CODE", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=480,width=750" ).focus();
        }
      // ]]>
    </script>
  </head>

  <body>
    <table width="100%" border='0' cellpadding='0' cellspacing='0' class='banner'>
    <tr><td>Ruby on Rails v3.0.3</td></tr>
    <tr>
  <td class="file-title"><span class="file-title-prefix">Module</span><br />ActionController::RequestForgeryProtection</td>
  <td align="right">
    <table cellspacing="0" cellpadding="2">
      <tr valign="top">
        <td>In:</td>
        <td>
<a href="../../files/actionpack/lib/action_controller/metal/request_forgery_protection_rb.html">actionpack/lib/action_controller/metal/request_forgery_protection.rb</a>:
        </td>
      </tr>
         </table>
        </td>
        </tr>
      </table>
  <div id="bodyContent">
  <div id="content">

  <div class="description"><p>
Protecting controller actions from CSRF attacks by ensuring that all forms
are coming from the current web application, not a forged link from another
site, is done by embedding a token based on a random string stored in the
session (which an attacker wouldn&#8217;t know) in all forms and Ajax
requests generated by <a href="../Rails.html">Rails</a> and then verifying
the authenticity of that token in the controller.  Only HTML/JavaScript
requests are checked, so this will not protect your XML API (presumably
you&#8217;ll have a different authentication scheme there anyway).  Also,
GET requests are not protected as these should be idempotent anyway.
</p>
<p>
This is turned on with the <tt><a
href="RequestForgeryProtection.html#method-i-protect_from_forgery">protect_from_forgery</a></tt>
method, which will check the token and raise an
ActionController::InvalidAuthenticityToken if it doesn&#8217;t match what
was expected. You can customize the error message in production by editing
public/422.html.  A call to this method in ApplicationController is
generated by default in post-<a href="../Rails.html">Rails</a> 2.0
applications.
</p>
<p>
The token parameter is named <tt>authenticity_token</tt> by default. If you
are generating an HTML form manually (without the use of Rails&#8217;
<tt>form_for</tt>, <tt>form_tag</tt> or other helpers), you have to include
a hidden field named like that and set its value to what is returned by
<tt><a
href="RequestForgeryProtection.html#method-i-form_authenticity_token">form_authenticity_token</a></tt>.
</p>
<p>
Request forgery protection is disabled by default in test environment. If
you are upgrading from <a href="../Rails.html">Rails</a> 1.x, add this to
config/environments/test.rb:
</p>
<pre>
  # Disable request forgery protection in test environment
  config.action_controller.allow_forgery_protection = false
</pre>
<h2>Learn more about CSRF (Cross-Site Request Forgery) attacks</h2>
<p>
Here are some resources:
</p>
<ul>
<li><p>
<a
href="http://isc.sans.org/diary.html?storyid=1750">isc.sans.org/diary.html?storyid=1750</a>
</p>
</li>
<li><p>
<a
href="http://en.wikipedia.org/wiki/Cross-site_request_forgery">en.wikipedia.org/wiki/Cross-site_request_forgery</a>
</p>
</li>
</ul>
<p>
Keep in mind, this is NOT a silver-bullet, plug &#8216;n&#8217; play, warm
security blanket for your rails application. There are a few guidelines you
should follow:
</p>
<ul>
<li><p>
Keep your GET requests safe and idempotent.  More reading material:
</p>
<ul>
<li><p>
<a
href="http://www.xml.com/pub/a/2002/04/24/deviant.html">www.xml.com/pub/a/2002/04/24/deviant.html</a>
</p>
</li>
</ul>
<ul>
<li><p>
<a
href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html#sec9.1.1">www.w3.org/Protocols/rfc2616/rfc2616-sec9.html#sec9.1.1</a>
</p>
</li>
</ul>
<ul>
<li><p>
Make sure the session cookies that <a href="../Rails.html">Rails</a>
creates are non-persistent.  Check in Firefox and look for &#8220;Expires:
at end of session&#8220;
</p>
</li>
</ul>
</li>
</ul>
</div>


  <div class="sectiontitle">Methods</div>
  <ul>
                <li><a href="#method-i-form_authenticity_param">form_authenticity_param</a></li>
                <li><a href="#method-i-form_authenticity_token">form_authenticity_token</a></li>
                <li><a href="#method-i-protect_against_forgery%3F">protect_against_forgery?</a></li>
                <li><a href="#method-i-protect_from_forgery">protect_from_forgery</a></li>
                <li><a href="#method-i-verified_request%3F">verified_request?</a></li>
                <li><a href="#method-i-verify_authenticity_token">verify_authenticity_token</a></li>
      </ul>

<div class="sectiontitle">Included Modules</div>
<ul>
  <li>
          <a href="../AbstractController/Helpers.html">AbstractController::Helpers</a>      </li>
  <li>
          <a href="../AbstractController/Callbacks.html">AbstractController::Callbacks</a>      </li>
</ul>



                            
    <div class="sectiontitle">
      Protected      Instance      methods
    </div>

          
      <div class="method">
        <div class="title">
                      <a name="method-i-form_authenticity_param"></a>
            <b>form_authenticity_param</b>()          
        </div>

                  <div class="description">
            <p>
The form&#8217;s authenticity parameter. Override to provide your own.
</p>          </div>
        
        
                  <div class="sourcecode">
            <p class="source-link">[
            <a href="javascript:toggleSource('form-authenticity-param_source')"
                 id="l_method-i-form_authenticity_param_source">
              show source
            </a> ]</p>
            <div class="dyn-source"
                    id="form-authenticity-param_source">
<pre>
       <span class="ruby-comment cmt"># File actionpack/lib/action_controller/metal/request_forgery_protection.rb, line 115</span>
115:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">form_authenticity_param</span>
116:         <span class="ruby-identifier">params</span>[<span class="ruby-identifier">request_forgery_protection_token</span>]
117:       <span class="ruby-keyword kw">end</span></pre>
            </div>
          </div>
        
      </div>

          
      <div class="method">
        <div class="title">
                      <a name="method-i-form_authenticity_token"></a>
            <b>form_authenticity_token</b>()          
        </div>

                  <div class="description">
            <p>
Sets the token value for the current session.
</p>          </div>
        
        
                  <div class="sourcecode">
            <p class="source-link">[
            <a href="javascript:toggleSource('form-authenticity-token_source')"
                 id="l_method-i-form_authenticity_token_source">
              show source
            </a> ]</p>
            <div class="dyn-source"
                    id="form-authenticity-token_source">
<pre>
       <span class="ruby-comment cmt"># File actionpack/lib/action_controller/metal/request_forgery_protection.rb, line 110</span>
110:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">form_authenticity_token</span>
111:         <span class="ruby-identifier">session</span>[<span class="ruby-value">:_csrf_token</span>] <span class="ruby-operator">||=</span> <span class="ruby-constant">ActiveSupport</span><span class="ruby-operator">::</span><span class="ruby-constant">SecureRandom</span>.<span class="ruby-identifier">base64</span>(<span class="ruby-value">32</span>)
112:       <span class="ruby-keyword kw">end</span></pre>
            </div>
          </div>
        
      </div>

          
      <div class="method">
        <div class="title">
                      <a name="method-i-protect_against_forgery%3F"></a>
            <b>protect_against_forgery?</b>()          
        </div>

                  <div class="description">
                      </div>
        
        
                  <div class="sourcecode">
            <p class="source-link">[
            <a href="javascript:toggleSource('protect-against-forgery-_source')"
                 id="l_method-i-protect_against_forgery%3F_source">
              show source
            </a> ]</p>
            <div class="dyn-source"
                    id="protect-against-forgery-_source">
<pre>
       <span class="ruby-comment cmt"># File actionpack/lib/action_controller/metal/request_forgery_protection.rb, line 119</span>
119:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">protect_against_forgery?</span>
120:         <span class="ruby-identifier">allow_forgery_protection</span>
121:       <span class="ruby-keyword kw">end</span></pre>
            </div>
          </div>
        
      </div>

          
      <div class="method">
        <div class="title">
                      <a name="method-i-protect_from_forgery"></a>
            <b>protect_from_forgery</b>(options = {})          
        </div>

                  <div class="description">
                      </div>
        
        
                  <div class="sourcecode">
            <p class="source-link">[
            <a href="javascript:toggleSource('protect-from-forgery_source')"
                 id="l_method-i-protect_from_forgery_source">
              show source
            </a> ]</p>
            <div class="dyn-source"
                    id="protect-from-forgery_source">
<pre>
      <span class="ruby-comment cmt"># File actionpack/lib/action_controller/metal/request_forgery_protection.rb, line 89</span>
89:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">protect_from_forgery</span>(<span class="ruby-identifier">options</span> = {})
90:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">request_forgery_protection_token</span> <span class="ruby-operator">||=</span> <span class="ruby-value">:authenticity_token</span>
91:         <span class="ruby-identifier">before_filter</span> <span class="ruby-value">:verify_authenticity_token</span>, <span class="ruby-identifier">options</span>
92:       <span class="ruby-keyword kw">end</span></pre>
            </div>
          </div>
        
      </div>

          
      <div class="method">
        <div class="title">
                      <a name="method-i-verified_request%3F"></a>
            <b>verified_request?</b>()          
        </div>

                  <div class="description">
            <p>
Returns true or false if a request is verified.  Checks:
</p>
<ul>
<li><p>
is the format restricted?  By default, only HTML requests are checked.
</p>
</li>
<li><p>
is it a GET request?  Gets should be safe and idempotent
</p>
</li>
<li><p>
Does the <a
href="RequestForgeryProtection.html#method-i-form_authenticity_token">form_authenticity_token</a>
match the given token value from the params?
</p>
</li>
</ul>          </div>
        
        
                  <div class="sourcecode">
            <p class="source-link">[
            <a href="javascript:toggleSource('verified-request-_source')"
                 id="l_method-i-verified_request%3F_source">
              show source
            </a> ]</p>
            <div class="dyn-source"
                    id="verified-request-_source">
<pre>
       <span class="ruby-comment cmt"># File actionpack/lib/action_controller/metal/request_forgery_protection.rb, line 104</span>
104:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">verified_request?</span>
105:         <span class="ruby-operator">!</span><span class="ruby-identifier">protect_against_forgery?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">forgery_whitelisted?</span> <span class="ruby-operator">||</span>
106:           <span class="ruby-identifier">form_authenticity_token</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">request_forgery_protection_token</span>]
107:       <span class="ruby-keyword kw">end</span></pre>
            </div>
          </div>
        
      </div>

          
      <div class="method">
        <div class="title">
                      <a name="method-i-verify_authenticity_token"></a>
            <b>verify_authenticity_token</b>()          
        </div>

                  <div class="description">
            <p>
The actual before_filter that is used.  Modify this to change how you
handle unverified requests.
</p>          </div>
        
        
                  <div class="sourcecode">
            <p class="source-link">[
            <a href="javascript:toggleSource('verify-authenticity-token_source')"
                 id="l_method-i-verify_authenticity_token_source">
              show source
            </a> ]</p>
            <div class="dyn-source"
                    id="verify-authenticity-token_source">
<pre>
      <span class="ruby-comment cmt"># File actionpack/lib/action_controller/metal/request_forgery_protection.rb, line 95</span>
95:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">verify_authenticity_token</span>
96:         <span class="ruby-identifier">verified_request?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">raise</span>(<span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">InvalidAuthenticityToken</span>)
97:       <span class="ruby-keyword kw">end</span></pre>
            </div>
          </div>
        
      </div>

          </div>
  </div>
  </body>
</html>
